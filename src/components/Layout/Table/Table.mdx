import { Meta, Canvas, Controls, Story } from '@storybook/addon-docs/blocks';
import { Table } from './Table';
import * as TableStories from './Table.stories';

<Meta of={TableStories} />

# Table

The `Table` component is a generic, flexible table component that can display any type of data. It accepts a `ListItem` component that renders each row, allowing for complete customization of row content. **Column styles are automatically applied** by the Table component, so you don't need to manage styles in your ListItem components.

### üì¶ Import

```tsx
import { Table, ColumnConfig } from '@taiv/ui';
```

---

### üìã Overview

The Table component provides a consistent table structure with customizable columns and row rendering. It handles the table header automatically based on your column configuration, and **automatically applies column styles to table cells** using DOM manipulation. This means your `ListItem` components can focus purely on content without worrying about column styling.

## <br />

### ‚öôÔ∏è Props

#### `columnConfigs: ColumnConfig[]`
An array of column configuration objects. Each `ColumnConfig` includes:
- `heading?: string` - The column header text
- `style?: CSSProperties` - CSS properties that will be automatically applied to all `<td>` elements in that column position

**Note:** The styles defined in `columnConfigs` are automatically applied to the corresponding `<td>` elements based on their position in the row (0-indexed). You don't need to manually apply these styles in your ListItem components.

#### `data: T[]`
An array of data items to display in the table. The type `T` is generic, allowing you to use any data structure.

#### `ListItem: React.ComponentType<{ data: T }>`
A component that renders a single table row. It receives:
- `data: T` - The data item for the current row

**Note:** Column styles are automatically applied by the Table component, so you don't need to pass or use `columnConfigs` in your ListItem component. Simply use plain `<td>` elements - the Table component will apply the appropriate column styles based on each cell's position in the row.

#### `placeholder?: React.ReactNode`
An optional placeholder element to display when no data is available (empty array or undefined). Use this to provide a friendly empty state message or illustration to users.

#### `shadow?: boolean`
An optional prop that adds shadow around the entire table. By default it is false.

#### `divider?: boolean`
An optional prop that adds divider coloring between the rows. By default it is false.

## <br />

### üí° Best Practices for ListItem Components

#### üèóÔ∏è Build ListItem Components in Application Repos

Due to the complexity and variety of use cases across different features, **it is recommended to build your `ListItem` components within your application repositories** rather than in the design system. This approach provides:

- **Flexibility**: Each feature can have its own specific row rendering logic
- **Maintainability**: Row components stay close to the features that use them
- **Customization**: Easy to add feature-specific interactions, styling, and business logic

#### üè∑Ô∏è Use Semantic HTML Elements

When building your `ListItem` component, always use semantic HTML elements:

- **`<tr>`** - For the table row element
- **`<td>`** - For each table cell element (no style props needed - column styles are applied automatically)

This ensures proper accessibility, semantic meaning, and table structure. **The order of your `<td>` elements must match the order of your `columnConfigs` array**, as styles are applied based on the cell's index position (0, 1, 2, etc.).

#### üìù Example ListItem Component Structure

```tsx
import React from 'react';

interface UserData {
  id: string;
  name: string;
  email: string;
  role: string;
  status: 'active' | 'inactive';
}

interface UserListItemProps {
  data: UserData;
}

export const UserListItem: React.FC<UserListItemProps> = ({ data }) => {
  return (
    <tr>
      <td>{data.name}</td>
      <td>{data.email}</td>
      <td>{data.role}</td>
      <td>
        <Badge color={data.status === 'active' ? 'success' : 'neutral'}>
          {data.status}
        </Badge>
      </td>
    </tr>
  );
};
```

**Key points:**
- No `columnConfigs` prop needed
- No manual style application on `<td>` elements
- Column styles from `columnConfigs` are automatically applied based on cell position
- The first `<td>` gets styles from `columnConfigs[0]`, second from `columnConfigs[1]`, etc.

## <br />

### ‚úÖ Key Guidelines

<table>
  <thead>
    <tr>
      <th>#</th>
      <th>Guideline</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>1</td>
      <td>Always return a `<tr>` element</td>
      <td>This is required for proper table structure</td>
    </tr>
    <tr>
      <td>2</td>
      <td>Use plain `<td>` elements</td>
      <td>Match the number of cells to your column configurations. No style props needed - column styles are automatically applied</td>
    </tr>
    <tr>
      <td>3</td>
      <td>Maintain column order</td>
      <td>The order of your `<td>` elements must match the order of `columnConfigs`. The first `<td>` gets styles from `columnConfigs[0]`, second from `columnConfigs[1]`, etc.</td>
    </tr>
    <tr>
      <td>4</td>
      <td>Column styles are automatic</td>
      <td>The Table component uses DOM manipulation to apply column styles</td>
    </tr>
    <tr>
      <td>5</td>
      <td>Handle empty states</td>
      <td>Consider how to display missing or null data</td>
    </tr>
    <tr>
      <td>6</td>
      <td>Add interactions carefully</td>
      <td>If rows are clickable, ensure proper accessibility attributes</td>
    </tr>
    <tr>
      <td>7</td>
      <td>Row-level styles are fine</td>
      <td>You can still apply styles to the `<tr>` element if needed (e.g., borders, height)</td>
    </tr>
  </tbody>
</table>

## <br />

### üìö Examples

#### üìÑ Basic Table with Text Data

```tsx
import { Table, ColumnConfig } from '@taiv-ui/components';

const columnConfigs: ColumnConfig[] = [
  { heading: 'Name', style: { width: '30%' } },
  { heading: 'Email', style: { width: '40%' } },
  { heading: 'Role', style: { width: '30%' } },
];

const data = [
  { id: '1', name: 'John Doe', email: 'john@example.com', role: 'Admin' },
  { id: '2', name: 'Jane Smith', email: 'jane@example.com', role: 'User' },
];

const BasicListItem = ({ data }) => (
  <tr>
    <td>{data.name}</td>
    <td>{data.email}</td>
    <td>{data.role}</td>
  </tr>
);

<Table columnConfigs={columnConfigs} data={data} ListItem={BasicListItem} />
```

Notice how the ListItem component uses plain `<td>` elements without any style props. The Table component automatically applies the column styles from `columnConfigs` based on each cell's position.

## <br />

#### üé® Table with Custom Components

The Table component excels when you need to display custom components within cells, such as badges, buttons, or other interactive elements.

```tsx
import { Table, ColumnConfig } from '@taiv-ui/components';
import { Badge } from '@taiv-ui/components';
import { Button } from '@taiv-ui/components';

const columnConfigs: ColumnConfig[] = [
  { heading: 'Product', style: { width: '25%' } },
  { heading: 'Status', style: { width: '20%' } },
  { heading: 'Price', style: { width: '20%' } },
  { heading: 'Actions', style: { width: '35%', textAlign: 'center' } },
];

const data = [
  { 
    id: '1', 
    product: 'Widget A', 
    status: 'active', 
    price: '$29.99',
    stock: 150 
  },
  { 
    id: '2', 
    product: 'Widget B', 
    status: 'low-stock', 
    price: '$39.99',
    stock: 5 
  },
];

const ProductListItem = ({ data }) => (
  <tr>
    <td>{data.product}</td>
    <td>
      <Badge 
        color={data.status === 'active' ? 'success' : 'warning'}
        variant="filled"
      >
        {data.status === 'active' ? 'In Stock' : 'Low Stock'}
      </Badge>
    </td>
    <td>{data.price}</td>
    <td>
      <Button size="sm" variant="primary">Edit</Button>
    </td>
  </tr>
);

<Table columnConfigs={columnConfigs} data={data} ListItem={ProductListItem} />
```

The column styles (width, textAlign, etc.) are automatically applied to the `<td>` elements. Your ListItem component focuses purely on rendering the content.

## <br />

#### üì≠ Table with Placeholder (Empty State)

Use the `placeholder` prop to display a friendly message when no data is available. This provides a better user experience than showing an empty table.

```tsx
import { Table, ColumnConfig } from '@taiv/ui';
import { Center } from '@taiv/ui';
import { Group } from '@taiv/ui';
import { Text } from '@taiv/ui';
import { IconInfoCircle } from '@tabler/icons-react';
import { neutral } from '@taiv/ui/constants/colors';

const columnConfigs: ColumnConfig[] = [
  { heading: 'Name', style: { width: '25%' } },
  { heading: 'Email', style: { width: '30%' } },
  { heading: 'Role', style: { width: '20%' } },
  { heading: 'Status', style: { width: '15%' } },
  { heading: 'Last Login', style: { width: '10%' } },
];

<Table
  columnConfigs={columnConfigs}
  placeholder={
    <Center py='5rem'>
      <Group gap='0.5rem' align='center'>
        <IconInfoCircle color={neutral[200]} size='2rem' />
        <Text>No data available at this time</Text>
      </Group>
    </Center>
  }
/>
```

When the `data` prop is empty or undefined and the placeholder is defined, the placeholder content will be rendered instead of an empty table body.

## <br />

### üñåÔ∏è Styling Columns

You can style individual columns using CSS properties in the `columnConfigs`. These styles are **automatically applied** to all `<td>` elements in the corresponding column position:

```tsx
const columnConfigs: ColumnConfig[] = [
  { 
    heading: 'Name', 
    style: {
      width: '30%',
      textAlign: 'left',
      paddingLeft: '16px'
    }
  },
  { 
    heading: 'Amount', 
    style: {
      width: '20%',
      textAlign: 'right',
      fontWeight: 'bold'
    }
  },
  { 
    heading: 'Date', 
    style: {
      width: '50%',
      textAlign: 'center'
    }
  },
];
```

**How it works:** The Table component uses a `useEffect` hook to find all `<td>` elements in the table body and applies the corresponding column styles based on each cell's index position (0, 1, 2, etc.). This happens automatically after the component renders, so you don't need to manage styles in your ListItem components.

**Important:** The order of your `<td>` elements in the ListItem component must match the order of `columnConfigs`. The first `<td>` will receive styles from `columnConfigs[0]`, the second from `columnConfigs[1]`, and so on.

## <br />

### ‚ôø Accessibility

The Table component uses semantic HTML (`<table>`, `<thead>`, `<tbody>`, `<tr>`, `<th>`, `<td>`) to ensure proper accessibility. When building your `ListItem` components:

<table>
  <thead>
    <tr>
      <th>Guideline</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>Content in all cells</td>
      <td>Ensure all cells contain content (use `&nbsp;` or empty string if needed)</td>
    </tr>
    <tr>
      <td>ARIA labels</td>
      <td>Add `aria-label` attributes if rows are interactive</td>
    </tr>
    <tr>
      <td>Matching cell counts</td>
      <td>Maintain proper table structure with matching cell counts</td>
    </tr>
  </tbody>
</table>
